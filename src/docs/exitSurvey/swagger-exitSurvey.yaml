# Exit Survey Forms & Questions - Sekretaris Departemen / Ketua Departemen
# Base path: /exit-survey

exit_survey_list:
  get:
    tags: [Exit Survey]
    summary: Get all exit survey forms
    description: Returns all exit survey forms with total question count.
    security:
      - bearerAuth: []
    responses:
      "200":
        description: Form list
        content:
          application/json:
            schema:
              type: object
              properties:
                success: { type: boolean }
                data:
                  type: array
                  items:
                    type: object
                    properties:
                      id: { type: string }
                      name: { type: string }
                      description: { type: string, nullable: true }
                      isActive: { type: boolean }
                      totalQuestions: { type: integer }
                      createdAt: { type: string, format: date-time }
                      updatedAt: { type: string, format: date-time }
      "401": { $ref: "#/components/responses/Unauthorized" }
      "403": { $ref: "#/components/responses/Forbidden" }

  post:
    tags: [Exit Survey]
    summary: Create exit survey form
    security:
      - bearerAuth: []
    requestBody:
      content:
        application/json:
          schema:
            type: object
            properties:
              name: { type: string }
              description: { type: string, nullable: true }
              isActive: { type: boolean, default: true }
    responses:
      "201":
        description: Form created
      "400": { $ref: "#/components/responses/BadRequest" }

exit_survey_detail:
  get:
    tags: [Exit Survey]
    summary: Get form by ID (with questions and options)
    security:
      - bearerAuth: []
    parameters:
      - in: path
        name: id
        required: true
        schema: { type: string }
    responses:
      "200":
        description: Form detail with questions
      "404": { $ref: "#/components/responses/NotFound" }

  patch:
    tags: [Exit Survey]
    summary: Update form
    security:
      - bearerAuth: []
    parameters:
      - in: path
        name: id
        required: true
        schema: { type: string }
    requestBody:
      content:
        application/json:
          schema:
            type: object
            properties:
              name: { type: string }
              description: { type: string, nullable: true }
              isActive: { type: boolean }
    responses:
      "200":
        description: Form updated
      "404": { $ref: "#/components/responses/NotFound" }

  delete:
    tags: [Exit Survey]
    summary: Delete form
    description: Fails if form is linked to any yudisium event.
    security:
      - bearerAuth: []
    parameters:
      - in: path
        name: id
        required: true
        schema: { type: string }
    responses:
      "200":
        description: Form deleted
      "404": { $ref: "#/components/responses/NotFound" }
      "409": { $ref: "#/components/responses/Conflict" }

exit_survey_toggle:
  patch:
    tags: [Exit Survey]
    summary: Toggle form active/archived
    security:
      - bearerAuth: []
    parameters:
      - in: path
        name: id
        required: true
        schema: { type: string }
    responses:
      "200":
        description: Form toggled
      "404": { $ref: "#/components/responses/NotFound" }

exit_survey_duplicate:
  post:
    tags: [Exit Survey]
    summary: Duplicate form (new ID, copy all questions and options)
    security:
      - bearerAuth: []
    parameters:
      - in: path
        name: id
        required: true
        schema: { type: string }
    responses:
      "201":
        description: Form duplicated
      "404": { $ref: "#/components/responses/NotFound" }

exit_survey_questions_list:
  get:
    tags: [Exit Survey]
    summary: Get questions by form ID
    security:
      - bearerAuth: []
    parameters:
      - in: path
        name: formId
        required: true
        schema: { type: string }
    responses:
      "200":
        description: Questions list
      "404": { $ref: "#/components/responses/NotFound" }

  post:
    tags: [Exit Survey]
    summary: Create question (with options for choice types)
    security:
      - bearerAuth: []
    parameters:
      - in: path
        name: formId
        required: true
        schema: { type: string }
    requestBody:
      content:
        application/json:
          schema:
            type: object
            required: [question, questionType]
            properties:
              question: { type: string }
              questionType: { type: string, enum: [single_choice, multiple_choice, text, textarea] }
              isRequired: { type: boolean, default: false }
              orderNumber: { type: integer, default: 0 }
              options: { type: array, items: { type: object, properties: { optionText: { type: string }, orderNumber: { type: integer } } } }
    responses:
      "201":
        description: Question created
      "400": { $ref: "#/components/responses/BadRequest" }
      "404": { $ref: "#/components/responses/NotFound" }

exit_survey_question_detail:
  get:
    tags: [Exit Survey]
    summary: Get question by ID
    security:
      - bearerAuth: []
    parameters:
      - in: path
        name: formId
        required: true
        schema: { type: string }
      - in: path
        name: questionId
        required: true
        schema: { type: string }
    responses:
      "200":
        description: Question detail
      "404": { $ref: "#/components/responses/NotFound" }

  patch:
    tags: [Exit Survey]
    summary: Update question
    security:
      - bearerAuth: []
    parameters:
      - in: path
        name: formId
        required: true
        schema: { type: string }
      - in: path
        name: questionId
        required: true
        schema: { type: string }
    requestBody:
      content:
        application/json:
          schema:
            type: object
            properties:
              question: { type: string }
              questionType: { type: string, enum: [single_choice, multiple_choice, text, textarea] }
              isRequired: { type: boolean }
              orderNumber: { type: integer }
              options: { type: array, items: { type: object } }
    responses:
      "200":
        description: Question updated
      "404": { $ref: "#/components/responses/NotFound" }

  delete:
    tags: [Exit Survey]
    summary: Delete question
    security:
      - bearerAuth: []
    parameters:
      - in: path
        name: formId
        required: true
        schema: { type: string }
      - in: path
        name: questionId
        required: true
        schema: { type: string }
    responses:
      "200":
        description: Question deleted
      "404": { $ref: "#/components/responses/NotFound" }
