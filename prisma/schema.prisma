// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

// Looking for ways to speed up your queries, or scale easily with your serverless or edge functions?
// Try Prisma Accelerate: https://pris.ly/cli/accelerate-init

generator client {
  provider = "prisma-client-js"
  output   = "../src/generated/prisma"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

// User Management
model User {
  id                String       @id @default(uuid())
  fullName          String       @map("full_name")
  identityNumber    String       @unique @map("identity_number")
  identityType      IdentityType @map("identity_type")
  email             String?      @unique
  password          String?
  phoneNumber       String?      @map("phone_number")
  isVerified        Boolean      @default(false)
  token             String?      @db.Text
  refreshToken      String?      @map("refresh_token") @db.Text
  // OAuth fields for Microsoft authentication
  oauthProvider     String?      @map("oauth_provider") // e.g., "microsoft", "google"
  oauthId           String?      @map("oauth_id") // Microsoft user ID or object ID
  oauthAccessToken  String?      @map("oauth_access_token") @db.Text // OAuth access token (encrypted)
  oauthRefreshToken String?      @map("oauth_refresh_token") @db.Text // OAuth refresh token (encrypted)
  createdAt         DateTime     @default(now())
  updatedAt         DateTime     @updatedAt

  // Relations
  userHasRoles                 UserHasRole[]
  student                      Student?
  lecturer                     Lecturer?
  documents                    Document[]
  notifications                Notification[]
  thesisSeminarAudiences       ThesisSeminarAudience[]
  thesisSeminarRubric          ThesisSeminarRubric[]
  thesisDefenceRubrics         ThesisDefenceRubric[]
  internshipApprovals          InternshipApproval[]
  internshipSeminarAttendances InternshipSeminarAudience[]
  internshipSeminarRequests    Internship[]                @relation("InternshipSeminarBookingRequester")
  internshipSeminarApprovals   Internship[]                @relation("InternshipSeminarBookingApprover")

  @@map("users")
}

model UserRole {
  id                  String               @id @default(uuid())
  name                String
  userHasRoles        UserHasRole[]
  // Back-relations for role_id references
  thesisParticipants  ThesisParticipant[]
  internshipApprovals InternshipApproval[]

  @@map("user_roles")
}

model UserHasRole {
  userId String     @map("user_id")
  roleId String     @map("role_id")
  status RoleStatus
  user   User       @relation(fields: [userId], references: [id], onDelete: Cascade)
  role   UserRole   @relation(fields: [roleId], references: [id], onDelete: Cascade)

  @@id([userId, roleId])
  @@map("user_has_roles")
}

// Student Management
model Student {
  id                   String                @id @map("user_id")
  studentStatusId      String?               @map("student_status_id")
  enrollmentYear       Int?                  @map("enrollment_year")
  user                 User                  @relation(fields: [id], references: [id], onDelete: Cascade)
  studentStatus        StudentStatus?        @relation(fields: [studentStatusId], references: [id])
  skscompleted         Int
  thesis               Thesis[]
  thesisProposal       ThesisProposal[]
  thesisChangeRequests ThesisChangeRequest[]
  researchMethodGrades ResearchMethodGrade[]
  internships          Internship[]
  yudisiumApplicants   YudisiumApplicant[]
  createdAt            DateTime              @default(now()) @map("created_at")
  updatedAt            DateTime              @updatedAt @map("updated_at")

  @@index([skscompleted], map: "idx_students_skscompleted")
  @@map("students")
}

model StudentStatus {
  id       String    @id @default(uuid())
  name     String
  students Student[]

  @@map("student_status")
}

// Lecturer Management
model Lecturer {
  id                             String                        @id @map("user_id")
  scienceGroupId                 String?                       @map("science_group_id")
  user                           User                          @relation(fields: [id], references: [id], onDelete: Cascade)
  scienceGroup                   ScienceGroup?                 @relation(fields: [scienceGroupId], references: [id])
  thesisParticipants             ThesisParticipant[]
  thesisExaminers                ThesisExaminer[]
  thesisGuidances                ThesisGuidance[]
  thesisSeminarAudiences         ThesisSeminarAudience[]
  validatedInternshipAttendances InternshipSeminarAudience[]
  thesisSeminarScores            ThesisSeminarScore[]
  thesisDefenceScores            ThesisDefenceScore[]
  internships                    Internship[]
  internshipGuidanceSchedules    InternshipGuidanceSchedule[]
  thesisChangeRequestsReviewed   ThesisChangeRequest[]
  thesisChangeRequestApprovals   ThesisChangeRequestApproval[]
  createdAt                      DateTime                      @default(now()) @map("created_at")
  updatedAt                      DateTime                      @updatedAt @map("updated_at")

  @@map("lecturers")
}

model ScienceGroup {
  id        String     @id @default(uuid())
  name      String
  lecturers Lecturer[]
  createdAt DateTime   @default(now()) @map("created_at")
  updatedAt DateTime   @updatedAt @map("updated_at")

  @@map("science_groups")
}

// Academic Management
model AcademicYear {
  id                   String                @id @default(uuid())
  semester             Semester              @default(ganjil)
  year                 Int?
  startDate            DateTime?             @map("start_date")
  endDate              DateTime?             @map("end_date")
  isActive             Boolean               @default(false) @map("is_active") // Hanya satu yang aktif
  thesis               Thesis[]
  thesisSeminarRubric  ThesisSeminarRubric[]
  thesisDefenceRubrics ThesisDefenceRubric[]
  internships          Internship[]
  createdAt            DateTime              @default(now()) @map("created_at")
  updatedAt            DateTime              @updatedAt @map("updated_at")

  @@map("academic_years")
}

model Room {
  id                        String                  @id @default(uuid())
  name                      String
  thesisSeminarSchedules    ThesisSeminarSchedule[]
  thesisDefenceSchedules    ThesisDefenceSchedule[]
  yudisiumSchedules         YudisiumSchedule[]
  internshipSeminarBookings Internship[]
  createdAt                 DateTime                @default(now()) @map("created_at")
  updatedAt                 DateTime                @updatedAt @map("updated_at")
  internshipSeminars        InternshipSeminar[]

  @@map("rooms")
}

// Thesis Management
enum ThesisRating {
  ONGOING
  SLOW
  AT_RISK
  FAILED
}

model Thesis {
  id               String       @id @default(uuid())
  rating           ThesisRating @default(ONGOING)
  studentId        String       @map("student_id")
  thesisTopicId    String?      @map("thesis_topic_id")
  thesisProposalId String?      @map("thesis_proposal_id")
  thesisStatusId   String?      @map("thesis_status_id")
  academicYearId   String?      @map("academic_year_id")
  documentId       String?      @map("document_id")
  title            String?
  startDate        DateTime?    @map("start_date")
  deadlineDate     DateTime?    @map("deadline_date")

  // Seminar Readiness Approval from Supervisors
  seminarReadyApprovedBySupervisor1 Boolean?  @default(false) @map("seminar_ready_approved_by_supervisor1")
  seminarReadyApprovedBySupervisor2 Boolean?  @default(false) @map("seminar_ready_approved_by_supervisor2")
  seminarReadyApprovedAt            DateTime? @map("seminar_ready_approved_at")
  seminarReadyNotes                 String?   @map("seminar_ready_notes") @db.Text

  // Defence Readiness Approval from Supervisors
  defenceReadyApprovedBySupervisor1 Boolean?  @default(false) @map("defence_ready_approved_by_supervisor1")
  defenceReadyApprovedBySupervisor2 Boolean?  @default(false) @map("defence_ready_approved_by_supervisor2")
  defenceReadyApprovedAt            DateTime? @map("defence_ready_approved_at")
  defenceReadyNotes                 String?   @map("defence_ready_notes") @db.Text
  finalThesisDocumentId             String?   @map("final_thesis_document_id")
  defenceRequestedAt                DateTime? @map("defence_requested_at")

  createdAt            DateTime              @default(now()) @map("created_at")
  updatedAt            DateTime              @updatedAt @map("updated_at")
  student              Student               @relation(fields: [studentId], references: [id])
  thesisTopic          ThesisTopic?          @relation(fields: [thesisTopicId], references: [id])
  thesisProposal       ThesisProposal?       @relation(fields: [thesisProposalId], references: [id])
  thesisStatus         ThesisStatus?         @relation(fields: [thesisStatusId], references: [id])
  academicYear         AcademicYear?         @relation(fields: [academicYearId], references: [id])
  document             Document?             @relation(fields: [documentId], references: [id])
  finalThesisDocument  Document?             @relation("FinalThesisDocument", fields: [finalThesisDocumentId], references: [id])
  thesisParticipants   ThesisParticipant[]
  thesisExaminers      ThesisExaminer[]
  thesisMilestones     ThesisMilestone[]
  thesisGuidances      ThesisGuidance[]
  thesisSeminars       ThesisSeminar[]
  thesisDefences       ThesisDefence[]
  thesisChangeRequests ThesisChangeRequest[]

  @@map("thesis")
}

// Request pergantian topik/pembimbing dari mahasiswa
model ThesisChangeRequest {
  id          String                    @id @default(uuid())
  studentId   String                    @map("student_id")
  thesisId    String?                   @map("thesis_id")
  requestType ThesisChangeRequestType   @map("request_type")
  reason      String                    @db.Text
  status      ThesisChangeRequestStatus @default(pending)
  reviewedBy  String?                   @map("reviewed_by")
  reviewNotes String?                   @map("review_notes") @db.Text
  reviewedAt  DateTime?                 @map("reviewed_at")
  createdAt   DateTime                  @default(now()) @map("created_at")
  updatedAt   DateTime                  @updatedAt @map("updated_at")

  student   Student                       @relation(fields: [studentId], references: [id])
  thesis    Thesis?                       @relation(fields: [thesisId], references: [id], onDelete: SetNull)
  reviewer  Lecturer?                     @relation(fields: [reviewedBy], references: [id])
  approvals ThesisChangeRequestApproval[]

  @@map("thesis_change_requests")
}

model ThesisChangeRequestApproval {
  id         String         @id @default(uuid())
  requestId  String         @map("request_id")
  lecturerId String         @map("lecturer_id")
  status     ApprovalStatus @default(pending)
  notes      String?        @db.Text
  createdAt  DateTime       @default(now()) @map("created_at")
  updatedAt  DateTime       @updatedAt @map("updated_at")

  request  ThesisChangeRequest @relation(fields: [requestId], references: [id], onDelete: Cascade)
  lecturer Lecturer            @relation(fields: [lecturerId], references: [id])

  @@unique([requestId, lecturerId])
  @@map("thesis_change_request_approvals")
}

// Penguji Thesis - untuk seminar dan sidang
// Satu tabel untuk track penguji di semua event
model ThesisExaminer {
  id          String            @id @default(uuid())
  thesisId    String            @map("thesis_id")
  lecturerId  String            @map("lecturer_id")
  eventType   ExaminerEventType @map("event_type") // seminar atau defence
  isChair     Boolean           @default(false) @map("is_chair") // Ketua penguji
  assignedAt  DateTime          @default(now()) @map("assigned_at")
  confirmedAt DateTime?         @map("confirmed_at") // Konfirmasi kehadiran
  thesis      Thesis            @relation(fields: [thesisId], references: [id], onDelete: Cascade)
  lecturer    Lecturer          @relation(fields: [lecturerId], references: [id])
  createdAt   DateTime          @default(now()) @map("created_at")
  updatedAt   DateTime          @updatedAt @map("updated_at")

  @@unique([thesisId, lecturerId, eventType]) // Satu dosen hanya sekali per thesis per event type
  @@index([thesisId, eventType])
  @@map("thesis_examiners")
}

model ThesisParticipant {
  id         String   @id @default(uuid())
  thesisId   String   @map("thesis_id")
  lecturerId String   @map("lecturer_id")
  roleId     String   @map("role_id")
  thesis     Thesis   @relation(fields: [thesisId], references: [id])
  lecturer   Lecturer @relation(fields: [lecturerId], references: [id])
  role       UserRole @relation(fields: [roleId], references: [id])
  createdAt  DateTime @default(now()) @map("created_at")
  updatedAt  DateTime @updatedAt @map("updated_at")

  @@map("thesis_participants")
}

model ThesisTopic {
  id                 String                    @id @default(uuid())
  name               String
  thesis             Thesis[]
  milestoneTemplates ThesisMilestoneTemplate[]
  createdAt          DateTime                  @default(now()) @map("created_at")
  updatedAt          DateTime                  @updatedAt @map("updated_at")

  @@map("thesis_topics")
}

model ThesisStatus {
  id     String   @id @default(uuid())
  name   String
  thesis Thesis[]

  @@map("thesis_status")
}

model ThesisProposal {
  id                   String                @id @default(uuid())
  studentId            String                @map("student_id")
  documentId           String?               @map("document_id")
  status               ProposalStatus        @default(submitted)
  student              Student               @relation(fields: [studentId], references: [id])
  document             Document?             @relation(fields: [documentId], references: [id])
  thesis               Thesis[]
  thesisProposalGrades ThesisProposalGrade[]
  createdAt            DateTime              @default(now()) @map("created_at")
  updatedAt            DateTime              @updatedAt @map("updated_at")

  @@map("thesis_proposal")
}

// Template milestone yang bisa digunakan sebagai referensi (opsional)
model ThesisMilestoneTemplate {
  id          String   @id @default(uuid())
  name        String
  description String?  @db.Text
  topicId     String?  @map("topic_id") // Relasi ke ThesisTopic
  orderIndex  Int      @default(0) @map("order_index")
  isActive    Boolean  @default(true) @map("is_active")
  createdAt   DateTime @default(now()) @map("created_at")
  updatedAt   DateTime @updatedAt @map("updated_at")

  // Relations
  topic ThesisTopic? @relation(fields: [topicId], references: [id], onDelete: SetNull)

  @@map("thesis_milestone_templates")
}

// Milestone custom per thesis yang dibuat oleh mahasiswa
model ThesisMilestone {
  id       String @id @default(uuid())
  thesisId String @map("thesis_id")

  // Detail milestone
  title       String
  description String? @db.Text
  orderIndex  Int     @default(0) @map("order_index")

  // Target dan timeline
  targetDate  DateTime? @map("target_date") // Deadline yang ditentukan mahasiswa
  startedAt   DateTime? @map("started_at") // Kapan mulai dikerjakan
  completedAt DateTime? @map("completed_at") // Kapan selesai

  // Status dan validasi
  status             MilestoneStatus @default(not_started)
  progressPercentage Int             @default(0) @map("progress_percentage") // 0-100

  // Review dari dosen pembimbing
  validatedBy     String?   @map("validated_by") // ID dosen yang memvalidasi
  validatedAt     DateTime? @map("validated_at")
  supervisorNotes String?   @map("supervisor_notes") @db.Text // Feedback dari dosen

  // Bukti/evidence
  evidenceUrl         String? @map("evidence_url") // Link file bukti
  evidenceDescription String? @map("evidence_description") @db.Text

  // Student notes
  studentNotes String? @map("student_notes") @db.Text // Catatan dari mahasiswa

  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  // Relations
  thesis    Thesis           @relation(fields: [thesisId], references: [id], onDelete: Cascade)
  guidances ThesisGuidance[] // Bimbingan yang terkait dengan milestone ini

  @@index([thesisId, orderIndex])
  @@index([thesisId, status])
  @@map("thesis_milestones")
}

model ThesisGuidance {
  id           String  @id @default(uuid())
  thesisId     String  @map("thesis_id")
  supervisorId String? @map("supervisor_id")
  milestoneId  String? @map("milestone_id") // Milestone yang dibahas dalam bimbingan ini
  milestoneIds Json?   @map("milestone_ids") // Daftar milestone yang dibahas (multi-select)

  // Request details
  requestedDate DateTime  @map("requested_date") // Tanggal/waktu yang diminta mahasiswa
  approvedDate  DateTime? @map("approved_date") // Tanggal/waktu yang disetujui dosen
  duration      Int       @default(60) // Durasi dalam menit
  documentUrl   String?   @map("document_url") // Link dokumen yang akan dibahas (Google Docs, Overleaf, dll)

  // Notes & feedback
  studentNotes       String? @map("student_notes") @db.Text // Agenda dari mahasiswa
  supervisorFeedback String? @map("supervisor_feedback") @db.Text // Feedback dari dosen
  rejectionReason    String? @map("rejection_reason") @db.Text // Alasan penolakan

  // Session summary (diisi mahasiswa setelah bimbingan)
  sessionSummary     String?   @map("session_summary") @db.Text // Ringkasan pembahasan
  actionItems        String?   @map("action_items") @db.Text // Tugas/action items
  summarySubmittedAt DateTime? @map("summary_submitted_at") // Kapan summary disubmit

  // Status
  status      GuidanceStatus @default(requested)
  completedAt DateTime?      @map("completed_at") // Kapan bimbingan selesai (approved by lecturer)

  // Outlook Calendar sync fields
  studentCalendarEventId    String? @map("student_calendar_event_id")
  supervisorCalendarEventId String? @map("supervisor_calendar_event_id")

  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  // Relations
  thesis      Thesis              @relation(fields: [thesisId], references: [id])
  supervisor  Lecturer?           @relation(fields: [supervisorId], references: [id])
  milestone   ThesisMilestone?    @relation(fields: [milestoneId], references: [id])
  sessionLogs ThesisGuidanceLog[] // Log untuk setiap sesi bimbingan

  @@index([thesisId, milestoneId])
  @@map("thesis_guidances")
}

// Log detail untuk setiap sesi bimbingan
model ThesisGuidanceLog {
  id            String   @id @default(uuid())
  guidanceId    String   @map("guidance_id")
  topic         String // Topik yang dibahas
  discussion    String?  @db.Text // Isi diskusi
  actionItems   String?  @map("action_items") @db.Text // Tugas/action items untuk mahasiswa
  attachmentUrl String?  @map("attachment_url") // Lampiran (file bimbingan)
  progressNotes String?  @map("progress_notes") @db.Text // Catatan progress
  createdAt     DateTime @default(now()) @map("created_at")
  updatedAt     DateTime @updatedAt @map("updated_at")

  guidance ThesisGuidance @relation(fields: [guidanceId], references: [id], onDelete: Cascade)

  @@map("thesis_guidance_logs")
}

// Thesis Seminar Management
model ThesisSeminar {
  id         String                  @id @default(uuid())
  thesisId   String                  @map("thesis_id")
  scheduleId String?                 @map("schedule_id")
  resultId   String?                 @map("result_id")
  status     SeminarStatus           @default(scheduled)
  thesis     Thesis                  @relation(fields: [thesisId], references: [id])
  schedule   ThesisSeminarSchedule?  @relation(fields: [scheduleId], references: [id])
  result     ThesisSeminarResult?    @relation(fields: [resultId], references: [id])
  audiences  ThesisSeminarAudience[]
  scores     ThesisSeminarScore[]
  createdAt  DateTime                @default(now()) @map("created_at")
  updatedAt  DateTime                @updatedAt @map("updated_at")

  @@map("thesis_seminars")
}

model ThesisSeminarSchedule {
  id        String          @id @default(uuid())
  roomId    String?         @map("room_id")
  startTime DateTime        @map("start_time")
  endTime   DateTime        @map("end_time")
  status    ScheduleStatus  @default(planned)
  room      Room?           @relation(fields: [roomId], references: [id])
  seminars  ThesisSeminar[]
  createdAt DateTime        @default(now()) @map("created_at")
  updatedAt DateTime        @updatedAt @map("updated_at")

  @@map("thesis_seminar_schedules")
}

model ThesisSeminarResult {
  id       String          @id @default(uuid())
  name     String
  seminars ThesisSeminar[]

  @@map("thesis_seminar_result")
}

model ThesisSeminarAudience {
  id          String        @id @default(uuid())
  seminarId   String        @map("seminar_id")
  userId      String        @map("user_id")
  validatedBy String?       @map("validated_by")
  validatedAt DateTime?     @map("validated_at")
  seminar     ThesisSeminar @relation(fields: [seminarId], references: [id])
  user        User          @relation(fields: [userId], references: [id])
  validator   Lecturer?     @relation(fields: [validatedBy], references: [id])
  createdAt   DateTime      @default(now()) @map("created_at")
  updatedAt   DateTime      @updatedAt @map("updated_at")

  @@map("thesis_seminar_audiences")
}

model ThesisSeminarRubric {
  id             String                      @id @default(uuid())
  academicYearId String?                     @map("academic_year_id")
  title          String?
  createdBy      String?                     @map("created_by")
  academicYear   AcademicYear?               @relation(fields: [academicYearId], references: [id])
  creator        User?                       @relation(fields: [createdBy], references: [id])
  details        ThesisSeminarRubricDetail[]
  createdAt      DateTime                    @default(now()) @map("created_at")
  updatedAt      DateTime                    @updatedAt @map("updated_at")

  @@map("thesis_seminar_rubric")
}

model ThesisSeminarRubricDetail {
  id        String               @id @default(uuid())
  rubricId  String               @map("rubric_id")
  indicator String?
  weight    Float?
  rubric    ThesisSeminarRubric  @relation(fields: [rubricId], references: [id])
  scores    ThesisSeminarScore[]
  createdAt DateTime             @default(now()) @map("created_at")
  updatedAt DateTime             @updatedAt @map("updated_at")

  @@map("thesis_seminar_rubric_details")
}

model ThesisSeminarScore {
  id             String                    @id @default(uuid())
  seminarId      String                    @map("seminar_id")
  rubricDetailId String                    @map("rubric_detail_id")
  scoredBy       String                    @map("scored_by")
  score          Int?
  comment        String?
  seminar        ThesisSeminar             @relation(fields: [seminarId], references: [id])
  rubricDetail   ThesisSeminarRubricDetail @relation(fields: [rubricDetailId], references: [id])
  scorer         Lecturer                  @relation(fields: [scoredBy], references: [id])
  createdAt      DateTime                  @default(now()) @map("created_at")
  updatedAt      DateTime                  @updatedAt @map("updated_at")

  @@map("thesis_seminar_scores")
}

// Thesis Defence Management
model ThesisDefence {
  id                      String                 @id @default(uuid())
  thesisId                String?                @map("thesis_id")
  thesisDefenceScheduleId String?                @map("thesis_defence_schedule_id")
  thesisDefenceStatusId   String?                @map("thesis_defence_status_id")
  thesis                  Thesis?                @relation(fields: [thesisId], references: [id])
  schedule                ThesisDefenceSchedule? @relation(fields: [thesisDefenceScheduleId], references: [id])
  status                  ThesisDefenceStatus?   @relation(fields: [thesisDefenceStatusId], references: [id])
  scores                  ThesisDefenceScore[]
  createdAt               DateTime               @default(now()) @map("created_at")
  updatedAt               DateTime               @updatedAt @map("updated_at")

  @@map("thesis_defences")
}

model ThesisDefenceSchedule {
  id                 String                @id @default(uuid())
  roomId             String?               @map("room_id")
  startTime          DateTime?             @map("start_time")
  endTime            DateTime?             @map("end_time")
  status             DefenceScheduleStatus @default(planned)
  supervisorApproval Boolean?              @map("supervisor_approval")
  room               Room?                 @relation(fields: [roomId], references: [id])
  defences           ThesisDefence[]
  createdAt          DateTime              @default(now()) @map("created_at")
  updatedAt          DateTime              @updatedAt @map("updated_at")

  @@map("thesis_defence_schedules")
}

model ThesisDefenceStatus {
  id       String          @id @default(uuid())
  name     String?
  defences ThesisDefence[]

  @@map("thesis_defence_status")
}

model ThesisDefenceRubric {
  id             String                      @id @default(uuid())
  academicYearId String?                     @map("academic_year_id")
  title          String?
  createdBy      String?                     @map("created_by")
  academicYear   AcademicYear?               @relation(fields: [academicYearId], references: [id])
  creator        User?                       @relation(fields: [createdBy], references: [id])
  details        ThesisDefenceRubricDetail[]
  createdAt      DateTime                    @default(now()) @map("created_at")
  updatedAt      DateTime                    @updatedAt @map("updated_at")

  @@map("thesis_defence_rubrics")
}

model ThesisDefenceRubricDetail {
  id        String               @id @default(uuid())
  rubricId  String               @map("rubric_id")
  indicator String?
  weight    Float?
  rubric    ThesisDefenceRubric  @relation(fields: [rubricId], references: [id])
  scores    ThesisDefenceScore[]
  createdAt DateTime             @default(now()) @map("created_at")
  updatedAt DateTime             @updatedAt @map("updated_at")

  @@map("thesis_defence_rubric_details")
}

model ThesisDefenceScore {
  id              String                    @id @default(uuid())
  thesisDefenceId String                    @map("thesis_defence_id")
  rubricDetailId  String                    @map("rubric_detail_id")
  scoredBy        String                    @map("scored_by")
  score           Int?
  reviewerNote    String?                   @map("reviewer_note")
  defence         ThesisDefence             @relation(fields: [thesisDefenceId], references: [id])
  rubricDetail    ThesisDefenceRubricDetail @relation(fields: [rubricDetailId], references: [id])
  scorer          Lecturer                  @relation(fields: [scoredBy], references: [id])
  createdAt       DateTime                  @default(now()) @map("created_at")
  updatedAt       DateTime                  @updatedAt @map("updated_at")

  @@map("thesis_defence_scores")
}

// Yudisium Management
model Yudisium {
  id                 String                @id @default(uuid())
  yudisiumScheduleId String?               @map("yudisium_schedule_id")
  yudisiumDecree     String?               @map("yudisium_decree")
  schedule           YudisiumSchedule?     @relation(fields: [yudisiumScheduleId], references: [id])
  participants       YudisiumParticipant[]
  createdAt          DateTime              @default(now()) @map("created_at")
  updatedAt          DateTime              @updatedAt @map("updated_at")

  @@map("yudisiums")
}

model YudisiumSchedule {
  id                     String         @id @default(uuid())
  roomId                 String?        @map("room_id")
  schedule               DateTime?
  status                 YudisiumStatus @default(planned)
  departmentHeadApproval Boolean?       @map("department_head_approval")
  room                   Room?          @relation(fields: [roomId], references: [id])
  yudisiums              Yudisium[]
  createdAt              DateTime       @default(now()) @map("created_at")
  updatedAt              DateTime       @updatedAt @map("updated_at")

  @@map("yudisium_schedules")
}

model YudisiumApplicant {
  id                        String                   @id @default(uuid())
  studentId                 String                   @map("student_id")
  yudisiumApplicantStatusId String?                  @map("yudisium_applicant_status_id")
  isEligible                Boolean?                 @map("is_eligible")
  student                   Student                  @relation(fields: [studentId], references: [id])
  status                    YudisiumApplicantStatus? @relation(fields: [yudisiumApplicantStatusId], references: [id])
  participants              YudisiumParticipant[]
  createdAt                 DateTime                 @default(now()) @map("created_at")
  updatedAt                 DateTime                 @updatedAt @map("updated_at")

  @@map("yudisium_applicants")
}

model YudisiumApplicantStatus {
  id         String              @id @default(uuid())
  name       String?
  applicants YudisiumApplicant[]

  @@map("yudisium_applicant_status")
}

model YudisiumParticipant {
  id                  String            @id @default(uuid())
  yudisiumId          String            @map("yudisium_id")
  yudisiumApplicantId String            @map("yudisium_applicant_id")
  yudisium            Yudisium          @relation(fields: [yudisiumId], references: [id])
  applicant           YudisiumApplicant @relation(fields: [yudisiumApplicantId], references: [id])
  createdAt           DateTime          @default(now()) @map("created_at")
  updatedAt           DateTime          @updatedAt @map("updated_at")

  @@map("yudisium_participants")
}

// Document Management
model Document {
  id                    String                 @id @default(uuid())
  userId                String?                @map("user_id")
  documentTypeId        String?                @map("document_type_id")
  filePath              String?                @map("file_path")
  fileName              String?                @map("file_name")
  createdAt             DateTime               @default(now()) @map("created_at")
  updatedAt             DateTime               @updatedAt @map("updated_at")
  user                  User?                  @relation(fields: [userId], references: [id])
  documentType          DocumentType?          @relation(fields: [documentTypeId], references: [id])
  thesis                Thesis[]
  thesisFinalDocument   Thesis[]               @relation("FinalThesisDocument")
  thesisProposal        ThesisProposal[]
  internshipApprovals   InternshipApproval[]
  internshipAssessments InternshipAssessment[]

  @@map("documents")
}

model DocumentType {
  id        String     @id @default(uuid())
  name      String?
  documents Document[]
  createdAt DateTime   @default(now()) @map("created_at")
  updatedAt DateTime   @updatedAt @map("updated_at")

  @@map("document_types")
}

// Notification Management
model Notification {
  id        String   @id @default(uuid())
  userId    String   @map("user_id")
  title     String?
  message   String?
  isRead    Boolean  @default(false) @map("is_read")
  createdAt DateTime @default(now()) @map("created_at")
  user      User     @relation(fields: [userId], references: [id])

  @@map("notifications")
}

// Grade Management
model ThesisProposalGrade {
  id         String          @id @default(uuid())
  proposalId String?         @map("proposal_id")
  grade      Int?
  proposal   ThesisProposal? @relation(fields: [proposalId], references: [id])
  createdAt  DateTime        @default(now()) @map("created_at")
  updatedAt  DateTime        @updatedAt @map("updated_at")

  @@map("thesis_proposal_grades")
}

model ResearchMethodGrade {
  id        String   @id @default(uuid())
  studentId String?  @map("student_id")
  grade     Int?
  student   Student? @relation(fields: [studentId], references: [id])
  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")

  @@map("research_method_grades")
}

// Internship Management
model company {
  id             String       @id @default(uuid())
  companyName    String       @map("company_name")
  companyAddress String       @map("company_address")
  createdAt      DateTime     @default(now()) @map("created_at")
  updatedAt      DateTime     @default(now()) @updatedAt @map("updated_at")
  internships    Internship[]

  @@map("companies")
}

model Internship {
  id                   String                       @id @default(uuid())
  studentId            String                       @map("student_id")
  companyId            String                       @map("company_id")
  fieldSupervisor      String?                      @map("field_supervisor")
  fieldSupervisorPhone String?                      @map("field_supervisor_phone")
  startDate            DateTime                     @map("start_date")
  endDate              DateTime                     @map("end_date")
  status               InternshipStatus             @default(ongoing)
  academicYearId       String?                      @map("academic_year_id")
  createdAt            DateTime                     @default(now()) @map("created_at")
  updatedAt            DateTime                     @default(now()) @updatedAt @map("updated_at")
  student              Student                      @relation(fields: [studentId], references: [id], onDelete: Cascade)
  company              company                      @relation(fields: [companyId], references: [id], onDelete: Cascade)
  academicYear         AcademicYear?                @relation(fields: [academicYearId], references: [id])
  lecturerId           String?                      @map("lecturer_id")
  lecturer             Lecturer?                    @relation(fields: [lecturerId], references: [id])
  reports              InternshipReport[]
  assessments          InternshipAssessment[]
  seminars             InternshipSeminar[]
  approvals            InternshipApproval[]
  guidanceSchedules    InternshipGuidanceSchedule[]

  // Seminar Booking Fields (Merged from InternshipSeminarBooking)
  seminarBookingRoomId      String?       @map("seminar_booking_room_id")
  seminarBookingRequestedBy String?       @map("seminar_booking_requested_by")
  seminarBookingApprovedBy  String?       @map("seminar_booking_approved_by")
  seminarBookingStatus      BookingStatus @default(requested) @map("seminar_booking_status")
  seminarBookingRequestedAt DateTime?     @default(now()) @map("seminar_booking_requested_at")
  seminarBookingApprovedAt  DateTime?     @map("seminar_booking_approved_at")

  // Seminar Booking Relations
  seminarBookingRoom      Room? @relation(fields: [seminarBookingRoomId], references: [id])
  seminarBookingRequester User? @relation("InternshipSeminarBookingRequester", fields: [seminarBookingRequestedBy], references: [id])
  seminarBookingApprover  User? @relation("InternshipSeminarBookingApprover", fields: [seminarBookingApprovedBy], references: [id])

  @@index([studentId], map: "idx_internships_student")
  @@index([companyId], map: "idx_internships_company")
  @@map("internships")
}

model InternshipReport {
  id                    String     @id @default(uuid())
  internshipId          String     @map("internship_id")
  entryDate             DateTime   @map("entry_date")
  activityDescription   String?    @map("activity_description")
  validatedBySupervisor Boolean    @default(false) @map("validated_by_supervisor")
  createdAt             DateTime   @default(now()) @map("created_at")
  internship            Internship @relation(fields: [internshipId], references: [id], onDelete: Cascade)

  @@index([internshipId], map: "idx_internship_reports_internship")
  @@map("internship_reports")
}

model InternshipAssessment {
  id                 String                   @id @default(uuid())
  internshipId       String                   @map("internship_id")
  score              Float?
  comments           String?
  type               InternshipAssessmentType
  rawImageDocumentId String?                  @map("raw_image_document_id")
  ocrText            String?                  @map("ocr_text")
  status             AssessmentStatus         @default(pending)
  createdAt          DateTime                 @default(now()) @map("created_at")
  internship         Internship               @relation(fields: [internshipId], references: [id], onDelete: Cascade)
  rawImageDocument   Document?                @relation(fields: [rawImageDocumentId], references: [id])

  @@index([internshipId], map: "idx_internship_assessments_internship")
  @@map("internship_assessments")
}

model InternshipSeminar {
  id           String                      @id @default(uuid())
  internshipId String                      @map("internship_id")
  roomId       String?                     @map("room_id")
  startTime    DateTime?                   @map("start_time")
  endTime      DateTime?                   @map("end_time")
  status       SeminarStatus               @default(scheduled)
  isPassed     Boolean?                    @map("is_passed")
  grade        Float?
  internship   Internship                  @relation(fields: [internshipId], references: [id], onDelete: Cascade)
  room         Room?                       @relation(fields: [roomId], references: [id])
  audiences    InternshipSeminarAudience[]
  createdAt    DateTime                    @default(now()) @map("created_at")
  updatedAt    DateTime                    @updatedAt @map("updated_at")

  @@map("internship_seminars")
}

model InternshipApproval {
  id             String         @id @default(uuid())
  internshipId   String         @map("internship_id")
  documentId     String?        @map("document_id")
  documentNumber String?        @map("document_number")
  approvedBy     String?        @map("approved_by")
  roleId         String?        @map("role_id")
  status         ApprovalStatus @default(pending)
  notes          String?
  approvedAt     DateTime?      @map("approved_at")
  internship     Internship     @relation(fields: [internshipId], references: [id], onDelete: Cascade)
  document       Document?      @relation(fields: [documentId], references: [id])
  approver       User?          @relation(fields: [approvedBy], references: [id])
  role           UserRole?      @relation(fields: [roleId], references: [id])
  createdAt      DateTime       @default(now()) @map("created_at")
  updatedAt      DateTime       @updatedAt @map("updated_at")

  @@map("internship_approvals")
}

model InternshipGuidanceSchedule {
  id                  String                 @id @default(uuid())
  internshipId        String                 @map("internship_id")
  lecturerId          String                 @map("lecturer_id")
  sessionNumber       Int                    @map("session_number") // 1 (Minggu 2), 2 (Minggu 4), 3 (Minggu 5-6)
  status              GuidanceScheduleStatus @default(requested)
  topic               String?
  currentProgress     String?                @map("current_progress") @db.Text
  problemsEncountered String?                @map("problems_encountered") @db.Text
  discussionSummary   String?                @map("discussion_summary") @db.Text
  actionItems         String?                @map("action_items") @db.Text
  lecturerFeedback    String?                @map("lecturer_feedback")
  createdAt           DateTime               @default(now()) @map("created_at")
  updatedAt           DateTime               @updatedAt @map("updated_at")
  internship          Internship             @relation(fields: [internshipId], references: [id], onDelete: Cascade)
  lecturer            Lecturer               @relation(fields: [lecturerId], references: [id])

  @@map("internship_guidance_schedules")
}

model InternshipSeminarAudience {
  id          String            @id @default(uuid())
  seminarId   String            @map("seminar_id")
  userId      String            @map("user_id")
  validatedBy String?           @map("validated_by")
  validatedAt DateTime?         @map("validated_at")
  seminar     InternshipSeminar @relation(fields: [seminarId], references: [id], onDelete: Cascade)
  user        User              @relation(fields: [userId], references: [id])
  validator   Lecturer?         @relation(fields: [validatedBy], references: [id])
  createdAt   DateTime          @default(now()) @map("created_at")
  updatedAt   DateTime          @updatedAt @map("updated_at")

  @@map("internship_seminar_audiences")
}

// Enums
enum IdentityType {
  NIM
  NIP
  OTHER
}

enum RoleStatus {
  active
  nonActive
}

enum Semester {
  ganjil
  genap
}

enum ThesisChangeRequestType {
  topic // Pergantian topik
  supervisor // Pergantian pembimbing
  both // Pergantian topik dan pembimbing
}

enum ThesisChangeRequestStatus {
  pending // Menunggu review Kadep
  approved // Disetujui, data TA dihapus
  rejected // Ditolak
}

enum ProposalStatus {
  submitted
  accepted
  rejected
}

enum GuidanceStatus {
  requested
  accepted
  rejected
  summary_pending // Mahasiswa sudah submit summary, menunggu approval dosen
  completed
  cancelled
}

enum ExaminerEventType {
  seminar // Penguji seminar
  defence // Penguji sidang
}

enum MilestoneStatus {
  not_started // Belum dimulai
  in_progress // Sedang dikerjakan
  pending_review // Menunggu review dosen
  revision_needed // Perlu revisi
  completed // Selesai dan disetujui
}

enum SeminarStatus {
  scheduled
  rescheduled
  ongoing
  completed
  cancelled
}

enum ScheduleStatus {
  planned
  rescheduled
  finalized
}

enum DefenceScheduleStatus {
  planned
  scheduled
  finalized
  cancelled
}

enum YudisiumStatus {
  planned
  finalized
  completed
}

enum InternshipStatus {
  ongoing
  completed
  cancelled
}

// Removed enums SupervisorRole, AssessorType, ApprovalRole in favor of user_roles relation via role_id

enum ApprovalStatus {
  pending
  approved
  rejected
}

enum GuidanceScheduleStatus {
  requested
  approved
  completed
  cancelled
}

enum AssessmentStatus {
  pending
  verified
}

enum InternshipAssessmentType {
  FIELD
  LECTURER
}

enum BookingStatus {
  requested
  approved
  cancelled
  completed
}
